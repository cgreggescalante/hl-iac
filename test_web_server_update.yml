- name: Install Git
  import_playbook: install_git.yml

- name: Install Go
  import_playbook: install_go.yml

- name: Update/Deploy the test web server
  hosts: web_host_1
  become: yes
  tasks:
    - name: Delete the old Nginx config
      command: rm -rf /etc/nginx
      ignore_errors: yes

    - name: Pull latest Nginx config
      git:
        repo: 'https://github.com/cgreggescalante/nginx-reverse-proxy'
        dest: /etc/nginx
        version: master
        force: yes

    - name: Test Nginx config
      command: nginx -t

    - name: Reload Nginx
      command: nginx -s reload